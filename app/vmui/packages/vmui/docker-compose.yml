services:
  victorialogs:
    image: ghcr.io/daibhid666/victoria-logs-plus:latest
    build:
      context: ../../../..
      dockerfile: Dockerfile
    container_name: victorialogs
    restart: always
    ports:
      - "9428:9428"
    volumes:
      - /data/victorialogs-data:/victoria-logs-data
      - /data/custom-api-data:/custom-api-data
    environment:
      - TZ=Asia/Shanghai
    command:
      - -storageDataPath=/victoria-logs-data
      - -retentionPeriod=15d
      - -customapi.dataDir=/custom-api-data
    logging:
      driver: json-file
      options:
        max-size: "100m"
        max-file: "3"
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://127.0.0.1:9428/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s
    ulimits:
      nofile: 262144
    mem_limit: 2g
    cpus: "4.0"
